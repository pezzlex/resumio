{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.setupLock = setupLock;\nexports.handleAuthCallback = handleAuthCallback;\nexports.resumeAuth = resumeAuth;\nexports.openLock = openLock;\nexports.closeLock = closeLock;\nexports.removeLock = removeLock;\nexports.updateLock = updateLock;\nexports.pinLoadingPane = pinLoadingPane;\nexports.unpinLoadingPane = unpinLoadingPane;\nexports.validateAndSubmit = validateAndSubmit;\nexports.logIn = logIn;\nexports.checkSession = checkSession;\nexports.logInSuccess = logInSuccess;\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _web_api = require('./web_api');\n\nvar _web_api2 = _interopRequireDefault(_web_api);\n\nvar _index = require('../store/index');\n\nvar _remote_data = require('./remote_data');\n\nvar _index2 = require('./index');\n\nvar l = _interopRequireWildcard(_index2);\n\nvar _preload_utils = require('../utils/preload_utils');\n\nvar _container = require('../ui/box/container');\n\nvar _index3 = require('../field/index');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction setupLock(id, clientID, domain, options, hookRunner, emitEventFn, handleEventFn) {\n  var m = l.setup(id, clientID, domain, options, hookRunner, emitEventFn, handleEventFn);\n  m = (0, _remote_data.syncRemoteData)(m);\n  (0, _preload_utils.img)(l.ui.logo(m) || _container.defaultProps.logo);\n\n  _web_api2.default.setupClient(id, clientID, domain, l.withAuthOptions(m, _extends({}, options, {\n    popupOptions: l.ui.popupOptions(m)\n  })));\n\n  m = l.runHook(m, 'didInitialize', options);\n  (0, _index.swap)(_index.setEntity, 'lock', id, m);\n  return m;\n}\n\nfunction handleAuthCallback() {\n  var ms = (0, _index.read)(_index.getCollection, 'lock');\n  var keepHash = ms.filter(function (m) {\n    return !l.hashCleanup(m);\n  }).size > 0;\n  var urlWithoutHash = global.location.href.split('#')[0];\n\n  var callback = function callback(error, authResult) {\n    var parsed = !!(error || authResult);\n\n    if (parsed && !keepHash) {\n      global.history.replaceState(null, '', urlWithoutHash);\n    }\n  };\n\n  resumeAuth(global.location.hash, callback);\n}\n\nfunction resumeAuth(hash, callback) {\n  var ms = (0, _index.read)(_index.getCollection, 'lock');\n  ms.forEach(function (m) {\n    return l.auth.redirect(m) && parseHash(m, hash, callback);\n  });\n}\n\nfunction parseHash(m, hash, cb) {\n  _web_api2.default.parseHash(l.id(m), hash, function (error, authResult) {\n    if (error) {\n      l.emitHashParsedEvent(m, error);\n    } else {\n      l.emitHashParsedEvent(m, authResult);\n    }\n\n    if (error) {\n      l.emitAuthorizationErrorEvent(m, error);\n    } else if (authResult) {\n      l.emitAuthenticatedEvent(m, authResult);\n    }\n\n    cb(error, authResult);\n  });\n}\n\nfunction openLock(id, opts) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (!m) {\n    throw new Error(\"The Lock can't be opened again after it has been destroyed\");\n  }\n\n  if (l.rendering(m)) {\n    return false;\n  }\n\n  if (opts.flashMessage) {\n    var supportedTypes = ['error', 'success', 'info'];\n\n    if (!opts.flashMessage.type || supportedTypes.indexOf(opts.flashMessage.type) === -1) {\n      return l.emitUnrecoverableErrorEvent(m, \"'flashMessage' must provide a valid type ['error','success','info']\");\n    }\n\n    if (!opts.flashMessage.text) {\n      return l.emitUnrecoverableErrorEvent(m, \"'flashMessage' must provide a text\");\n    }\n  }\n\n  l.emitEvent(m, 'show');\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.overrideOptions(m, opts);\n    m = l.filterConnections(m);\n    m = l.runHook(m, 'willShow', opts);\n    return l.render(m);\n  });\n  return true;\n}\n\nfunction closeLock(id) {\n  var force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {}; // Do nothing when the Lock can't be closed, unless closing is forced.\n\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (!l.ui.closable(m) && !force || !l.rendering(m)) {\n    return;\n  }\n\n  l.emitEvent(m, 'hide'); // If it is a modal, stop rendering an reset after a second,\n  // otherwise just reset.\n\n  if (l.ui.appendContainer(m)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.stopRendering);\n    setTimeout(function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n        m = (0, _index3.hideInvalidFields)(m);\n        m = l.reset(m);\n        m = (0, _index3.clearFields)(m);\n        return m;\n      });\n      m = (0, _index.read)(_index.getEntity, 'lock', id);\n      callback(m);\n    }, 1000);\n  } else {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      m = (0, _index3.hideInvalidFields)(m);\n      m = l.reset(m);\n      m = (0, _index3.clearFields)(m);\n      return m;\n    });\n    callback(m);\n  }\n}\n\nfunction removeLock(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.stopRendering);\n  (0, _index.swap)(_index.removeEntity, 'lock', id);\n}\n\nfunction updateLock(id, f) {\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, f);\n}\n\nfunction pinLoadingPane(id) {\n  var lock = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (!lock.get('isLoadingPanePinned')) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      return m.set('isLoadingPanePinned', true);\n    });\n  }\n}\n\nfunction unpinLoadingPane(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    return m.set('isLoadingPanePinned', false);\n  });\n}\n\nfunction validateAndSubmit(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  var f = arguments[2];\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    var allFieldsValid = fields.reduce(function (r, x) {\n      return r && (0, _index3.isFieldValid)(m, x);\n    }, true);\n    return allFieldsValid ? l.setSubmitting(m, true) : fields.reduce(function (r, x) {\n      return (0, _index3.showInvalidField)(r, x);\n    }, m);\n  });\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (l.submitting(m)) {\n    f(m);\n  }\n}\n\nfunction logIn(id, fields) {\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var logInErrorHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_id, error, _fields, next) {\n    return next();\n  };\n  validateAndSubmit(id, fields, function (m) {\n    _web_api2.default.logIn(id, params, l.auth.params(m).toJS(), function (error, result) {\n      if (error) {\n        setTimeout(function () {\n          return logInError(id, fields, error, logInErrorHandler);\n        }, 250);\n      } else {\n        logInSuccess(id, result);\n      }\n    });\n  });\n}\n\nfunction checkSession(id) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    return l.setSubmitting(m, true);\n  });\n\n  _web_api2.default.checkSession(id, params, function (err, result) {\n    if (err) {\n      return logInError(id, [], err);\n    }\n\n    return logInSuccess(id, result);\n  });\n}\n\nfunction logInSuccess(id, result) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (!l.ui.autoclose(m)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      m = l.setSubmitting(m, false);\n      return l.setLoggedIn(m, true);\n    });\n    l.emitAuthenticatedEvent(m, result);\n  } else {\n    closeLock(id, false, function (m1) {\n      return l.emitAuthenticatedEvent(m1, result);\n    });\n  }\n}\n\nfunction logInError(id, fields, error) {\n  var localHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_id, _error, _fields, next) {\n    return next();\n  };\n  var errorCode = error.error || error.code;\n  localHandler(id, error, fields, function () {\n    return setTimeout(function () {\n      var m = (0, _index.read)(_index.getEntity, 'lock', id);\n      var errorMessage = l.loginErrorMessage(m, error, loginType(fields));\n      var errorCodesThatEmitAuthorizationErrorEvent = ['blocked_user', 'rule_error', 'lock.unauthorized', 'invalid_user_password', 'login_required'];\n\n      if (errorCodesThatEmitAuthorizationErrorEvent.indexOf(errorCode) > -1) {\n        l.emitAuthorizationErrorEvent(m, error);\n      }\n\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    }, 0);\n  });\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false);\n}\n\nfunction loginType(fields) {\n  if (!fields) return;\n  if (~fields.indexOf('vcode')) return 'code';\n  if (~fields.indexOf('username')) return 'username';\n  if (~fields.indexOf('email')) return 'email';\n}","map":{"version":3,"sources":["/Users/pezannekhambatta/Desktop/resumio/node_modules/auth0-lock/lib/core/actions.js"],"names":["exports","__esModule","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","setupLock","handleAuthCallback","resumeAuth","openLock","closeLock","removeLock","updateLock","pinLoadingPane","unpinLoadingPane","validateAndSubmit","logIn","checkSession","logInSuccess","_immutable","require","_immutable2","_interopRequireDefault","_web_api","_web_api2","_index","_remote_data","_index2","l","_interopRequireWildcard","_preload_utils","_container","_index3","obj","newObj","default","id","clientID","domain","options","hookRunner","emitEventFn","handleEventFn","m","setup","syncRemoteData","img","ui","logo","defaultProps","setupClient","withAuthOptions","popupOptions","runHook","swap","setEntity","ms","read","getCollection","keepHash","filter","hashCleanup","size","urlWithoutHash","global","location","href","split","callback","error","authResult","parsed","history","replaceState","hash","forEach","auth","redirect","parseHash","cb","emitHashParsedEvent","emitAuthorizationErrorEvent","emitAuthenticatedEvent","opts","getEntity","Error","rendering","flashMessage","supportedTypes","type","indexOf","emitUnrecoverableErrorEvent","text","emitEvent","updateEntity","overrideOptions","filterConnections","render","force","undefined","closable","appendContainer","stopRendering","setTimeout","hideInvalidFields","reset","clearFields","removeEntity","f","lock","get","set","fields","allFieldsValid","reduce","r","x","isFieldValid","setSubmitting","showInvalidField","submitting","params","logInErrorHandler","_id","_fields","next","toJS","result","logInError","err","autoclose","setLoggedIn","m1","localHandler","_error","errorCode","code","errorMessage","loginErrorMessage","loginType","errorCodesThatEmitAuthorizationErrorEvent"],"mappings":"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","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.setupLock = setupLock;\nexports.handleAuthCallback = handleAuthCallback;\nexports.resumeAuth = resumeAuth;\nexports.openLock = openLock;\nexports.closeLock = closeLock;\nexports.removeLock = removeLock;\nexports.updateLock = updateLock;\nexports.pinLoadingPane = pinLoadingPane;\nexports.unpinLoadingPane = unpinLoadingPane;\nexports.validateAndSubmit = validateAndSubmit;\nexports.logIn = logIn;\nexports.checkSession = checkSession;\nexports.logInSuccess = logInSuccess;\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _web_api = require('./web_api');\n\nvar _web_api2 = _interopRequireDefault(_web_api);\n\nvar _index = require('../store/index');\n\nvar _remote_data = require('./remote_data');\n\nvar _index2 = require('./index');\n\nvar l = _interopRequireWildcard(_index2);\n\nvar _preload_utils = require('../utils/preload_utils');\n\nvar _container = require('../ui/box/container');\n\nvar _index3 = require('../field/index');\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction setupLock(id, clientID, domain, options, hookRunner, emitEventFn, handleEventFn) {\n  var m = l.setup(id, clientID, domain, options, hookRunner, emitEventFn, handleEventFn);\n\n  m = (0, _remote_data.syncRemoteData)(m);\n\n  (0, _preload_utils.img)(l.ui.logo(m) || _container.defaultProps.logo);\n\n  _web_api2.default.setupClient(id, clientID, domain, l.withAuthOptions(m, _extends({}, options, {\n    popupOptions: l.ui.popupOptions(m)\n  })));\n\n  m = l.runHook(m, 'didInitialize', options);\n\n  (0, _index.swap)(_index.setEntity, 'lock', id, m);\n\n  return m;\n}\n\nfunction handleAuthCallback() {\n  var ms = (0, _index.read)(_index.getCollection, 'lock');\n  var keepHash = ms.filter(function (m) {\n    return !l.hashCleanup(m);\n  }).size > 0;\n  var urlWithoutHash = global.location.href.split('#')[0];\n  var callback = function callback(error, authResult) {\n    var parsed = !!(error || authResult);\n    if (parsed && !keepHash) {\n      global.history.replaceState(null, '', urlWithoutHash);\n    }\n  };\n  resumeAuth(global.location.hash, callback);\n}\n\nfunction resumeAuth(hash, callback) {\n  var ms = (0, _index.read)(_index.getCollection, 'lock');\n  ms.forEach(function (m) {\n    return l.auth.redirect(m) && parseHash(m, hash, callback);\n  });\n}\n\nfunction parseHash(m, hash, cb) {\n  _web_api2.default.parseHash(l.id(m), hash, function (error, authResult) {\n    if (error) {\n      l.emitHashParsedEvent(m, error);\n    } else {\n      l.emitHashParsedEvent(m, authResult);\n    }\n\n    if (error) {\n      l.emitAuthorizationErrorEvent(m, error);\n    } else if (authResult) {\n      l.emitAuthenticatedEvent(m, authResult);\n    }\n    cb(error, authResult);\n  });\n}\n\nfunction openLock(id, opts) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  if (!m) {\n    throw new Error(\"The Lock can't be opened again after it has been destroyed\");\n  }\n\n  if (l.rendering(m)) {\n    return false;\n  }\n\n  if (opts.flashMessage) {\n    var supportedTypes = ['error', 'success', 'info'];\n    if (!opts.flashMessage.type || supportedTypes.indexOf(opts.flashMessage.type) === -1) {\n      return l.emitUnrecoverableErrorEvent(m, \"'flashMessage' must provide a valid type ['error','success','info']\");\n    }\n    if (!opts.flashMessage.text) {\n      return l.emitUnrecoverableErrorEvent(m, \"'flashMessage' must provide a text\");\n    }\n  }\n\n  l.emitEvent(m, 'show');\n\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.overrideOptions(m, opts);\n    m = l.filterConnections(m);\n    m = l.runHook(m, 'willShow', opts);\n    return l.render(m);\n  });\n\n  return true;\n}\n\nfunction closeLock(id) {\n  var force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};\n\n  // Do nothing when the Lock can't be closed, unless closing is forced.\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  if (!l.ui.closable(m) && !force || !l.rendering(m)) {\n    return;\n  }\n\n  l.emitEvent(m, 'hide');\n\n  // If it is a modal, stop rendering an reset after a second,\n  // otherwise just reset.\n  if (l.ui.appendContainer(m)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.stopRendering);\n\n    setTimeout(function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n        m = (0, _index3.hideInvalidFields)(m);\n        m = l.reset(m);\n        m = (0, _index3.clearFields)(m);\n        return m;\n      });\n      m = (0, _index.read)(_index.getEntity, 'lock', id);\n      callback(m);\n    }, 1000);\n  } else {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      m = (0, _index3.hideInvalidFields)(m);\n      m = l.reset(m);\n      m = (0, _index3.clearFields)(m);\n      return m;\n    });\n    callback(m);\n  }\n}\n\nfunction removeLock(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.stopRendering);\n  (0, _index.swap)(_index.removeEntity, 'lock', id);\n}\n\nfunction updateLock(id, f) {\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, f);\n}\n\nfunction pinLoadingPane(id) {\n  var lock = (0, _index.read)(_index.getEntity, 'lock', id);\n  if (!lock.get('isLoadingPanePinned')) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      return m.set('isLoadingPanePinned', true);\n    });\n  }\n}\n\nfunction unpinLoadingPane(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    return m.set('isLoadingPanePinned', false);\n  });\n}\n\nfunction validateAndSubmit(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  var f = arguments[2];\n\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    var allFieldsValid = fields.reduce(function (r, x) {\n      return r && (0, _index3.isFieldValid)(m, x);\n    }, true);\n    return allFieldsValid ? l.setSubmitting(m, true) : fields.reduce(function (r, x) {\n      return (0, _index3.showInvalidField)(r, x);\n    }, m);\n  });\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  if (l.submitting(m)) {\n    f(m);\n  }\n}\n\nfunction logIn(id, fields) {\n  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var logInErrorHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_id, error, _fields, next) {\n    return next();\n  };\n\n  validateAndSubmit(id, fields, function (m) {\n    _web_api2.default.logIn(id, params, l.auth.params(m).toJS(), function (error, result) {\n      if (error) {\n        setTimeout(function () {\n          return logInError(id, fields, error, logInErrorHandler);\n        }, 250);\n      } else {\n        logInSuccess(id, result);\n      }\n    });\n  });\n}\n\nfunction checkSession(id) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    return l.setSubmitting(m, true);\n  });\n  _web_api2.default.checkSession(id, params, function (err, result) {\n    if (err) {\n      return logInError(id, [], err);\n    }\n    return logInSuccess(id, result);\n  });\n}\n\nfunction logInSuccess(id, result) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n  if (!l.ui.autoclose(m)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      m = l.setSubmitting(m, false);\n      return l.setLoggedIn(m, true);\n    });\n    l.emitAuthenticatedEvent(m, result);\n  } else {\n    closeLock(id, false, function (m1) {\n      return l.emitAuthenticatedEvent(m1, result);\n    });\n  }\n}\n\nfunction logInError(id, fields, error) {\n  var localHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_id, _error, _fields, next) {\n    return next();\n  };\n\n  var errorCode = error.error || error.code;\n  localHandler(id, error, fields, function () {\n    return setTimeout(function () {\n      var m = (0, _index.read)(_index.getEntity, 'lock', id);\n      var errorMessage = l.loginErrorMessage(m, error, loginType(fields));\n      var errorCodesThatEmitAuthorizationErrorEvent = ['blocked_user', 'rule_error', 'lock.unauthorized', 'invalid_user_password', 'login_required'];\n\n      if (errorCodesThatEmitAuthorizationErrorEvent.indexOf(errorCode) > -1) {\n        l.emitAuthorizationErrorEvent(m, error);\n      }\n\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    }, 0);\n  });\n\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false);\n}\n\nfunction loginType(fields) {\n  if (!fields) return;\n  if (~fields.indexOf('vcode')) return 'code';\n  if (~fields.indexOf('username')) return 'username';\n  if (~fields.indexOf('email')) return 'email';\n}\n"]},"metadata":{},"sourceType":"script"}